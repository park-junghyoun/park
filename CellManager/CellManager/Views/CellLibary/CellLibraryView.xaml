<UserControl x:Class="CellManager.Views.CellLibary.CellLibraryView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:CellManager.Views"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="1000">

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="50"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,10,0,0">
            <Button Content="New Cell" Command="{Binding AddCellCommand}" Margin="0,0,50,0" Width="100"/>
            <Button Content="Edit" Command="{Binding OpenDetailsCommand}" CommandParameter="{Binding SelectedCell}" Margin="0,0,20,0" Width="80"/>
            <Button Content="Delete" Command="{Binding DeleteCellCommand}" Margin="0,0,30,0" Width="80"/>
        </StackPanel>
        <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="5" Margin="0,0,0,10" Background="White">
            <Grid>
                <TextBlock Text="Search &amp; Filter" Margin="8" VerticalAlignment="Center" Foreground="Gray" IsHitTestVisible="True" Opacity="0.6"/>
                <TextBox Padding="5" BorderThickness="0" Background="Transparent" VerticalAlignment="Center"
                         Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"/>
            </Grid>
        </Border>

        <ListView x:Name="lv_cells" ItemsSource="{Binding FilteredCells}" Margin="5" Grid.Row="2" SizeChanged="ListView_SizeChanged">

            <!-- Row 높이와 MaterialDesign MinHeight 설정 -->
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="Height" Value="30"/>
                    <!-- 고정 Row 높이 -->
                    <Setter Property="MinHeight" Value="30"/>
                    <!-- MaterialDesign 기본 MinHeight 덮어쓰기 -->
                </Style>
            </ListView.ItemContainerStyle>
            
            <ListView.View>
                <GridView>
                    <!-- Cell Name -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Cell name" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding DisplayNameAndId}" FontWeight="Bold" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Update Date -->
                    <GridViewColumn Header="Update Date" Width="180">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding LastUpdated, StringFormat='{}{0:yyyy-MM-dd HH:mm:ss}'}" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Manufacturer -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Cell Manufacturer" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Manufacturer}" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Cell Type -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Cell Type" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding CellType}" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    
                    <!-- Nominal Voltage -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Nominal Voltag" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding NominalVoltage, StringFormat={}{0:F2}V}" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Rated Capacity -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Rated Capacity" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding RatedCapacity, StringFormat={}{0:F2}Ah}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Serial Number -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Serial Number" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding SerialNumber}" Margin="-5" Padding="5"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                    <!-- Select Button -->
                    <GridViewColumn >
                        <GridViewColumnHeader Content="Activity" HorizontalAlignment="Stretch" Padding="5"/>
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <Button  Command="{Binding DataContext.SelectCellCommand, RelativeSource={RelativeSource AncestorType=ListView}}" MinWidth="100"
                    CommandParameter="{Binding}" materialDesign:ButtonProgressAssist.IsIndeterminate="True" materialDesign:ButtonProgressAssist.IsIndicatorVisible="{Binding IsActive}" materialDesign:ButtonProgressAssist.Value="-1">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource MaterialDesignRaisedButton}">
                                            <Setter Property="Content" Value="Inactive"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsActive}" Value="True">
                                                    <Setter Property="Content" Value="Active"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>

                </GridView>
            </ListView.View>
        </ListView>


    </Grid>
</UserControl>