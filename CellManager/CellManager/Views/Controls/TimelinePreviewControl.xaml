<UserControl x:Class="CellManager.Views.Controls.TimelinePreviewControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:converters="clr-namespace:CellManager.Converters"
             xmlns:vm="clr-namespace:CellManager.ViewModels"
             mc:Ignorable="d"
             d:DesignHeight="200" d:DesignWidth="400">
    <UserControl.Resources>
        <converters:IsNotLastItemConverter x:Key="IsNotLastItemConverter"/>
    </UserControl.Resources>
    <ItemsControl ItemsSource="{Binding Steps, RelativeSource={RelativeSource AncestorType=UserControl}}"
                  HorizontalAlignment="Stretch"
                  ClipToBounds="True"
                  AlternationCount="1000">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel Orientation="Horizontal" Height="40"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Border Margin="1" Padding="4,2" MinWidth="70" Height="32"
                            Background="{DynamicResource PrimaryHueLightBrush}"
                            BorderBrush="#E5E7EB" BorderThickness="1" CornerRadius="4">
                        <Border.ToolTip>
                            <StackPanel>
                                <TextBlock Text="{Binding StepNumber, StringFormat=Step {0}}"/>
                                <TextBlock Text="{Binding Id, StringFormat=ID\: {0}}"/>
                                <TextBlock Text="{Binding Name, StringFormat=Name\: {0}}"/>
                                <TextBlock Text="{Binding Parameters, StringFormat=Params\: {0}}"/>
                                <TextBlock Text="{Binding Duration, StringFormat='Duration\: {0:hh\\:mm\\:ss}'}"/>
                            </StackPanel>
                        </Border.ToolTip>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <materialDesign:PackIcon Kind="{Binding IconKind}" Width="16" Height="16" Margin="0,0,4,0"/>
                            <TextBlock FontSize="11" FontWeight="SemiBold" Foreground="Black">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="{Binding Id}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Kind}" Value="{x:Static vm:StepKind.LoopStart}">
                                                <Setter Property="Text" Value="Start"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Kind}" Value="{x:Static vm:StepKind.LoopEnd}">
                                                <Setter Property="Text" Value="End"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </Border>
                    <materialDesign:PackIcon Kind="ChevronRight" Width="14" Height="14" Margin="4,0" VerticalAlignment="Center">
                        <materialDesign:PackIcon.Visibility>
                            <MultiBinding Converter="{StaticResource IsNotLastItemConverter}">
                                <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ContentPresenter}" Path="(ItemsControl.AlternationIndex)"/>
                                <Binding RelativeSource="{RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}" Path="Items.Count"/>
                            </MultiBinding>
                        </materialDesign:PackIcon.Visibility>
                    </materialDesign:PackIcon>
                </StackPanel>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl>
</UserControl>

